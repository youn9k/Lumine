# Lumine 프로젝트 분석 보고서

**작성일**: 2025-11-24
**분석 대상**: Lumine - 로컬 미디어 플레이어

---

## 1. 프로젝트 개요

### 1.1 프로젝트 설명
Lumine은 로컬 비디오 파일을 재생하는 크로스 플랫폼 미디어 플레이어 앱입니다. iOS/iPadOS, macOS, visionOS를 지원하며, 일반 모드와 숏폼 모드의 듀얼 UI를 제공하는 것이 특징입니다.

### 1.2 타겟 플랫폼
- **iOS/iPadOS**: 18.0 이상
- **macOS**: 15.0 이상
- **visionOS**: 2.0 이상
- **지원 기기**: iPhone, iPad, Mac, Apple Vision Pro

### 1.3 Bundle 정보
- **Bundle ID**: com.youngkyu.Lumine
- **버전**: 1.0
- **개발 언어**: Swift

---

## 2. 기술 스택

### 2.1 프레임워크 및 라이브러리
| 구분 | 기술 | 용도 |
|------|------|------|
| UI 프레임워크 | SwiftUI | 선언형 UI 구축 |
| 비디오 재생 | AVKit, AVFoundation | 비디오 플레이어 및 미디어 처리 |
| 아키텍처 패턴 | MVVM + Observation | 상태 관리 및 반응형 UI |
| 오디오 세션 | AVAudioSession | 오디오 출력 관리 |
| 파일 시스템 | FileManager, DocumentPicker | 파일 접근 및 보안 스코프 관리 |
| 동시성 | Swift Concurrency (async/await) | 비동기 작업 처리 |

### 2.2 주요 Apple 기술 활용
- **@Observable**: Swift 5.9의 새로운 관찰 매크로 사용
- **Security-Scoped Bookmarks**: macOS 샌드박스에서 파일 접근 권한 유지
- **Picture in Picture (PiP)**: 백그라운드 비디오 재생
- **Keyboard Shortcuts**: macOS에서 키보드 단축키 지원
- **Drag & Drop**: 파일 드래그 앤 드롭 인터페이스

---

## 3. 아키텍처 구조

### 3.1 프로젝트 구조
```
Lumine/
├── App/                    # 앱 진입점
│   └── LumineApp.swift
├── Models/                 # 데이터 모델
│   └── SidebarCategory.swift
├── ViewModels/            # MVVM 뷰모델
│   ├── MainViewModel.swift
│   └── MainViewModel+Action.swift
├── Services/              # 비즈니스 로직
│   ├── VideoPlayerService.swift
│   ├── FileService.swift
│   ├── AudioSessionService.swift
│   └── ThumbnailService.swift
├── Views/                 # UI 컴포넌트
│   ├── MainView.swift
│   ├── LibraryView.swift
│   ├── ShortFormPlayerView.swift
│   ├── NormalPlayerView.swift
│   ├── PlayerContainerView.swift
│   ├── SidebarView.swift
│   └── Components/
│       ├── ThumbnailView.swift
│       └── VideoPlayerWrapper.swift
└── Utilities/             # 유틸리티 및 확장
    ├── DesignSystem.swift
    ├── KeyboardShortcuts.swift
    ├── View+Extension.swift
    └── Notifcation+Extension.swift
```

### 3.2 아키텍처 패턴
**MVVM (Model-View-ViewModel) + Unidirectional Data Flow**

- **View**: SwiftUI 뷰 컴포넌트
- **ViewModel**: `MainViewModel`이 앱의 중앙 상태 관리
- **Model**: `SidebarCategory`, 파일 URL 등
- **Service Layer**: 비즈니스 로직 분리 (Video, File, Audio, Thumbnail)

### 3.3 상태 관리
```swift
@Observable
final class MainViewModel {
  // Services
  let videoPlayerService = VideoPlayerService()
  let fileService = FileService()

  // State
  private(set) var selectedCategory: SidebarCategory = .allVideos
  private(set) var isShowPlayer: Bool = false
  private(set) var playerMode: PlayerMode = .normal
  private(set) var currentVideoIndex: Int = 0
  private(set) var isFullScreen: Bool = false

  // Action-based state mutation
  func send(_ action: Action) { ... }
}
```

**특징**:
- Action 기반 상태 변경 (Redux 스타일)
- `@Observable` 매크로로 자동 상태 관찰
- 읽기 전용 상태 (`private(set)`)로 단방향 데이터 플로우 보장

---

## 4. 주요 기능

### 4.1 듀얼 UI 모드

#### 일반 모드 (Normal Mode)
- 전통적인 비디오 플레이어 UI
- 하단에 재생 컨트롤러 표시
- 진행바(Seek Bar)로 구간 이동
- 자동 숨김 컨트롤 (3초 후 자동 숨김)
- PiP(Picture in Picture) 지원

**주요 컨트롤**:
- 재생/일시정지
- 앞/뒤 5초 건너뛰기
- 반복 재생 토글
- 전체화면 전환
- PiP 모드 진입

#### 숏폼 모드 (Short Form Mode)
- TikTok/YouTube Shorts 스타일 UI
- 세로 스크롤로 비디오 전환
- 페이징 스크롤 (한 번에 하나씩)
- 탭으로 재생/일시정지
- 자동 반복 재생 (기본값)
- 레터박스로 화면비 조정

**제스처 지원**:
- 위/아래 스와이프: 이전/다음 영상
- 탭: 재생/일시정지
- macOS: 방향키(↑↓) 네비게이션

### 4.2 파일 관리

#### 지원 포맷
- MP4, MOV, M4V, HEVC, H.264
- UTType 기반 파일 타입 검증

#### 파일 추가 방법
1. **Drag & Drop**: 메인 화면에 파일 드래그
2. **바로 재생하기**: 파일 선택 다이얼로그로 단일 파일 추가
3. **폴더 가져오기**: 재귀/비재귀 폴더 스캔 (예정)

#### 보안 및 권한
```swift
// Security-Scoped Resource 접근
url.startAccessingSecurityScopedResource()

// Bookmark 저장으로 영구 접근 권한 유지
let bookmarkData = try url.bookmarkData(
  options: [.withSecurityScope],
  includingResourceValuesForKeys: nil,
  relativeTo: nil
)
```

- macOS 샌드박스 환경에서 파일 접근 권한 관리
- Bookmark를 UserDefaults에 저장하여 앱 재시작 시 복원 (현재 비활성화)

### 4.3 비디오 재생 기능

**VideoPlayerService**:
- AVPlayer 기반 재생 엔진
- 실시간 재생 위치 업데이트 (0.5초 간격)
- 자동 반복 재생 지원
- 재생 속도 제어 (rate 조정 가능)

**재생 컨트롤**:
- `play()` / `pause()` / `togglePlayPause()`
- `seek(to:)`: 특정 시간으로 이동
- `seek(by:)`: 상대적 시간 이동 (±5초)
- 자동 루핑 (`isLooping`)

### 4.4 오디오 세션 관리

```swift
AudioSessionService.shared.configureAudioSession()
```

- 앱 시작 시 오디오 세션 설정
- 백그라운드 재생 및 다른 앱과의 오디오 믹싱 관리

### 4.5 썸네일 생성

**ThumbnailService**:
- 비디오 파일의 첫 프레임 추출
- 캐싱 메커니즘으로 성능 최적화
- 비동기 로딩으로 UI 블로킹 방지

### 4.6 키보드 단축키 (macOS)

| 키 | 동작 |
|---|------|
| Space | 재생/일시정지 |
| ← / → | 뒤로/앞으로 5초 이동 |
| ↑ / ↓ | 이전/다음 비디오 (숏폼 모드) |
| Escape | 플레이어 닫기 |

### 4.7 UI/UX 특징

**디자인 시스템**:
- `AppColors`: 통일된 색상 팔레트 (스카이블루 강조색)
- `LayoutConstants`: 일관된 레이아웃 상수
- Glassmorphism 스타일 (`ultraThinMaterial`)

**반응형 레이아웃**:
- GeometryReader로 동적 크기 조정
- iPad, Mac, Vision Pro에 최적화된 레이아웃
- 사이드바 확장/축소 애니메이션
- 사이드바 위치 변경 (좌/우)

**전체화면 모드**:
- 전체화면 시 사이드바 자동 숨김
- Safe Area 무시로 진정한 전체화면 구현
- 컨트롤 오버레이 유지

---

## 5. 최근 개발 이력

최근 커밋 로그 (최신 10개):
```
6c47426 바로 재생 기능 추가
9bb796d 뷰 코드 리팩토링
d27d42d 전체화면 기능 추가
ae831cc 뷰 코드 리팩토링
bc93a08 숏폼 UI 문제 수정
f6455b7 썸네일이 터치가 안먹는 문제 수정
a5c4d6a SideBarView 리네이밍
76d6b67 Merge remote-tracking branch 'origin/master'
2fe34b4 Delete Lumine/Lumine.xcodeproj/project.xcworkspace/xcuserdata
1b5bb36 UI 수정
```

**최근 주요 개선사항**:
1. 바로 재생 기능 추가 - 파일 선택 즉시 재생
2. 전체화면 모드 구현
3. 숏폼 UI 안정성 개선
4. 썸네일 터치 감지 버그 수정
5. 뷰 코드 리팩토링 및 구조 개선

---

## 6. 코드 품질 분석

### 6.1 강점
✅ **명확한 아키텍처**: MVVM + Service 레이어로 관심사 분리
✅ **최신 Swift 기술**: @Observable, async/await, Swift Concurrency
✅ **타입 안전성**: Enum 기반 Action/State 관리
✅ **재사용성**: 컴포넌트 단위로 뷰 분리
✅ **로깅**: 모든 액션에 디버그 로그 포함
✅ **크로스 플랫폼**: 조건부 컴파일로 iOS/macOS 분기 처리

### 6.2 개선 가능 영역
⚠️ **북마크 복원 비활성화**:
```swift
init() {
    //restoreBookmarks()  // 주석 처리됨
}
```
→ 앱 재시작 시 파일 목록 초기화 문제

⚠️ **에러 핸들링 부족**:
- 파일 로딩 실패 시 사용자 피드백 없음
- 비디오 재생 오류 처리 미흡

⚠️ **테스트 코드 부재**:
- `LumineTests/` 디렉토리 존재하나 내용 미확인

⚠️ **하드코딩된 값**:
- Seek 간격 5초 고정 (`seekInterval` 변경 가능하나 UI 없음)
- 타이머 3초 하드코딩

---

## 7. 기획서 대비 구현 현황

### 7.1 완료된 기능 ✅
- [x] 듀얼 UI 모드 (일반/숏폼)
- [x] 비디오 파일 재생 (MP4, MOV, HEVC 등)
- [x] Drag & Drop 파일 추가
- [x] 재생 컨트롤 (재생/일시정지, 구간 이동)
- [x] 자동 재생/반복 기능
- [x] 전체화면 모드
- [x] macOS 지원 및 키보드 단축키
- [x] 썸네일 생성 및 표시
- [x] PiP(Picture in Picture) 지원

### 7.2 미구현/개선 필요 기능 ⏳
- [ ] **제스처 지원 부족**:
  - ❌ 두 손가락 핀치로 화면비율 조정
  - ❌ 좌우 스와이프로 10초 앞/뒤 이동
  - ❌ 길게 눌러서 빠른 탐색 (2x, 4x 속도)

- [ ] **재생 기록**: 마지막 재생 위치 저장 미구현
- [ ] **플레이리스트**: 저장/불러오기 기능 없음
- [ ] **설정 화면**: Seek 간격 등 사용자 설정 UI 부재
- [ ] **에러 알림**: 파일 로딩 실패 시 알림 없음
- [ ] **visionOS 최적화**: 코드는 지원하나 특화 UI 없음

---

## 8. 향후 개선 방향

### 8.1 단기 개선사항 (1-2주)
1. **북마크 복원 기능 활성화**: 앱 재시작 시 파일 목록 유지
2. **에러 핸들링 강화**: Alert로 사용자 피드백 제공
3. **설정 화면 추가**: Seek 간격, 자동 재생 등 사용자 커스터마이징
4. **재생 기록 저장**: UserDefaults로 마지막 재생 위치 저장
5. **제스처 컨트롤 구현**: 스와이프, 핀치 제스처 추가

### 8.2 중기 개선사항 (1개월)
1. **플레이리스트 기능**: 재생 목록 저장/불러오기
2. **검색 및 필터링**: 파일명 검색, 날짜/크기 정렬
3. **재생 속도 조절 UI**: 0.5x ~ 2.0x 속도 선택
4. **자막 지원**: SRT, VTT 파일 로딩
5. **화면비 조정 메뉴**: Fill, Fit, Stretch 옵션

### 8.3 장기 개선사항 (2-3개월)
1. **visionOS 특화 UI**: Spatial 인터페이스 활용
2. **iCloud 동기화**: 재생 기록 및 플레이리스트 클라우드 동기화
3. **네트워크 스트리밍**: URL 기반 비디오 재생
4. **비디오 편집**: 트림, 회전 등 간단한 편집 기능
5. **앱 내 파일 브라우저**: 더 강력한 파일 관리

---

## 9. 기술 부채 및 리스크

### 9.1 기술 부채
1. **주석 처리된 코드**: `restoreBookmarks()` 등 정리 필요
2. **매직 넘버**: 3.0초, 5.0초 등 상수로 추출 필요
3. **긴 함수**: `processDroppedItems` 등 리팩토링 필요
4. **중복 코드**: 버튼 스타일 등 재사용 가능한 컴포넌트화

### 9.2 리스크
1. **메모리 관리**: 대용량 비디오 파일 처리 시 메모리 사용량 검증 필요
2. **동시성 이슈**: 파일 스캔 중 UI 업데이트 동기화
3. **보안 스코프 누수**: `stopAccessingSecurityScopedResource()` 누락 가능성
4. **플랫폼 버전 의존성**: iOS 18.0+ 요구사항으로 사용자층 제한

---

## 10. 결론

Lumine은 최신 Swift 및 SwiftUI 기술을 활용한 **잘 설계된 미디어 플레이어 앱**입니다.

**핵심 강점**:
- 명확한 아키텍처와 코드 구조
- 듀얼 UI 모드로 차별화된 사용자 경험
- 크로스 플랫폼 지원 (iOS, macOS, visionOS)
- 최신 Apple 기술 적극 활용

**개선이 필요한 부분**:
- 에러 핸들링 및 사용자 피드백 강화
- 제스처 컨트롤 및 고급 재생 기능 추가
- 설정 화면 및 사용자 커스터마이징 옵션
- 테스트 코드 작성 및 품질 보증

기획서에 명시된 핵심 기능의 약 **70-80%가 구현**되었으며, 안정적인 MVP(Minimum Viable Product) 상태입니다. 제스처 컨트롤, 재생 기록, 설정 화면 등을 추가하면 완성도 높은 제품으로 발전할 수 있습니다.

---

## 부록: 파일별 코드 라인 수

| 파일 | 라인 수 | 설명 |
|------|---------|------|
| MainViewModel.swift | 149 | 메인 뷰모델 |
| FileService.swift | 258 | 파일 관리 서비스 |
| VideoPlayerService.swift | 110 | 비디오 재생 서비스 |
| ShortFormPlayerView.swift | 146 | 숏폼 UI |
| NormalPlayerView.swift | 213 | 일반 플레이어 UI |
| LibraryView.swift | 129 | 라이브러리 그리드 UI |
| MainView.swift | 45 | 메인 뷰 |
| **전체** | **21개 파일** | **~1500-2000 라인** |

---

**보고서 작성**: Claude Code
**분석 일시**: 2025-11-24
**프로젝트 상태**: 개발 진행 중 (MVP 완료)
